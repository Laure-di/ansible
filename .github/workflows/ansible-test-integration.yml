name: Integration

on:
  pull_request:
    branches:
      - main
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  integration:
    runs-on: ubuntu-latest
    timeout-minutes: 40
    strategy:
      fail-fast: false
      max-parallel: 1
      matrix:
        module:
          - scaleway_registry_namespace

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Perform testing
        uses: ansible-community/ansible-test-gh-action@release/v1
        with:
          target-python-version: 3.9
          controller-python-version: auto
          target: ${{ matrix.module }}
          testing-type: integration
        env:
          SCW_ACCESS_KEY: ${{ secrets.SCW_ACCESS_KEY }}
          SCW_SECRET_KEY: ${{ secrets.SCW_SECRET_KEY }}
          SCW_DEFAULT_PROJECT_ID: ${{ secrets.SCW_DEFAULT_PROJECT_ID }}
